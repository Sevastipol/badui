<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BL√ÖHAJ Soft toy, shark - IKEA</title>
<link rel="icon" type="image/svg+xml" href="https://www.ikea.com/global/assets/logos/brand/ikea.svg">
<style>
  /* --- IKEA LEGITIMACY LAYER --- */
  body { font-family: 'Noto Sans', 'Roboto', Arial, sans-serif; background-color: #fff; margin: 0; color: #111; overflow-x: hidden; }
  header { padding: 20px 50px; border-bottom: 1px solid #e5e5e5; display: flex; align-items: center; justify-content: space-between; background: white; }
  .ikea-logo { background: #0058a3; color: #ffdb00; padding: 10px 15px; font-weight: 900; font-size: 24px; text-decoration: none; display: inline-block; }
  
  /* Header Icons */
  .header-icons { display: flex; gap: 20px; align-items: center; }
  .account-icon-container, .cart-icon-container { position: relative; cursor: pointer; }
  .account-icon, .cart-icon { width: 32px; height: 32px; display: block; }
  .account-initial { width: 32px; height: 32px; background: #ffdb00; color: #0058a3; border-radius: 50%; display: none; align-items: center; justify-content: center; font-weight: 900; font-size: 16px; cursor: pointer; }
  .cart-count { position: absolute; top: -8px; right: -8px; background: #d93025; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; display: none; }
  
  /* Notification Toast */
  .notification-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 3000; display: flex; flex-direction: column; gap: 10px; align-items: center; pointer-events: none; }
  .notification { background: #0058a3; color: white; padding: 16px 24px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 12px; min-width: 300px; animation: slideDown 0.3s ease-out; pointer-events: auto; }
  .notification.error { background: #d93025; }
  @keyframes slideDown { from { transform: translateY(-100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  .notification.fade-out { animation: fadeOut 0.3s ease-out forwards; }
  @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }
  .notification .check-icon { font-size: 24px; }
  
  /* Shopping Cart Sidebar */
  .cart-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 2400; }
  .cart-overlay.show { display: block; }
  .cart-sidebar { position: fixed; right: -420px; top: 0; width: 420px; height: 100%; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.2); z-index: 2500; transition: right 0.3s ease; display: flex; flex-direction: column; }
  .cart-sidebar.open { right: 0; }
  .cart-header { padding: 24px; border-bottom: 1px solid #e5e5e5; display: flex; justify-content: space-between; align-items: center; }
  .cart-header h2 { margin: 0; font-size: 24px; }
  .close-cart { font-size: 28px; cursor: pointer; color: #888; line-height: 1; }
  .close-cart:hover { color: #111; }
  .cart-items { padding: 24px; overflow-y: auto; flex: 1; }
  .cart-item { display: flex; gap: 16px; padding: 16px; border-bottom: 1px solid #f0f0f0; align-items: center; }
  .cart-item img { width: 80px; height: 80px; object-fit: contain; }
  .cart-item-info { flex: 1; }
  .cart-item-name { font-weight: 600; font-size: 16px; margin-bottom: 4px; }
  .cart-item-price { color: #484848; font-size: 14px; }
  .remove-item { background: #fff; border: 1px solid #ccc; padding: 6px 12px; cursor: pointer; font-size: 12px; }
  .remove-item:hover { background: #f0f0f0; }
  .cart-empty { text-align: center; padding: 60px 20px; color: #888; }
  .cart-footer { padding: 24px; border-top: 2px solid #e5e5e5; background: #fafafa; }
  .cart-subtotal { display: flex; justify-content: space-between; font-size: 16px; margin-bottom: 16px; }
  .checkout-btn { background-color: #0058a3; color: white; border: none; padding: 16px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 50px; width: 100%; }
  .checkout-btn:hover { background-color: #004f93; }
  .checkout-btn:disabled { background-color: #ccc; cursor: not-allowed; }
  
  /* Remove Confirmation Modal */
  .remove-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 3100; align-items: center; justify-content: center; }
  .remove-modal { background: white; width: 450px; padding: 30px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
  .remove-modal h3 { margin: 0 0 20px; font-size: 20px; color: #0058a3; }
  .remove-modal-description { color: #555; font-size: 14px; margin-bottom: 25px; line-height: 1.6; }
  .remove-modal-buttons { display: flex; gap: 10px; }
  .remove-modal-btn { flex: 1; padding: 14px; font-size: 15px; font-weight: bold; cursor: pointer; border: none; border-radius: 50px; }
  .remove-cancel { background: #fff; color: #0058a3; border: 2px solid #0058a3; }
  .remove-cancel:hover { background: #f0f0f0; }
  .remove-confirm { background: #d93025; color: white; }
  .remove-confirm:hover { background: #c02820; }
  
  /* Account Sign Up Page */
  .account-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3500; overflow-y: auto; }
  .account-container { max-width: 500px; margin: 0 auto; padding: 60px 20px; }
  .account-header { text-align: center; margin-bottom: 40px; }
  .account-header h1 { font-size: 32px; margin: 0 0 10px; color: #0058a3; }
  .account-header p { color: #666; font-size: 14px; }
  .back-btn { background: none; border: none; color: #0058a3; cursor: pointer; font-size: 16px; margin-bottom: 20px; display: flex; align-items: center; gap: 5px; }
  .back-btn:hover { text-decoration: underline; }
  .form-group { margin-bottom: 20px; }
  .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
  .form-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
  .form-group input:focus { outline: none; border-color: #0058a3; }
  .signup-btn { background-color: #0058a3; color: white; border: none; padding: 16px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 50px; width: 100%; margin-top: 10px; }
  .signup-btn:hover { background-color: #004f93; }
  .terms { font-size: 12px; color: #666; margin-top: 20px; line-height: 1.6; }
  .terms a { color: #0058a3; text-decoration: none; }
  .terms a:hover { text-decoration: underline; }
  
  /* Terms of Service Page */
  .tos-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3600; overflow-y: auto; }
  .tos-container { max-width: 900px; margin: 0 auto; padding: 40px 20px 100px; }
  .tos-header { text-align: center; margin-bottom: 40px; border-bottom: 3px solid #0058a3; padding-bottom: 30px; }
  .tos-header h1 { font-size: 36px; margin: 0 0 10px; color: #0058a3; font-weight: 900; }
  .tos-header .effective-date { color: #666; font-size: 14px; font-style: italic; }
  .tos-section { margin-bottom: 35px; }
  .tos-section h2 { font-size: 22px; color: #0058a3; margin: 0 0 15px; font-weight: 700; }
  .tos-section h3 { font-size: 18px; color: #111; margin: 20px 0 10px; font-weight: 600; }
  .tos-section p { line-height: 1.8; margin-bottom: 15px; color: #333; font-size: 14px; }
  .tos-section ul, .tos-section ol { margin: 15px 0; padding-left: 30px; }
  .tos-section li { margin-bottom: 10px; line-height: 1.8; color: #333; font-size: 14px; }
  .tos-close-btn { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background-color: #0058a3; color: white; border: none; padding: 16px 40px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 50px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .tos-close-btn:hover { background-color: #004f93; }
  .highlight-box { background: #fff8dc; border-left: 4px solid #ffdb00; padding: 15px; margin: 20px 0; }
  .warning-box { background: #ffe6e6; border-left: 4px solid #d93025; padding: 15px; margin: 20px 0; }
  
  /* Payment Page */
  .payment-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 3500; overflow-y: auto; }
  .payment-container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
  .payment-header { text-align: center; margin-bottom: 40px; }
  .payment-header h1 { font-size: 32px; margin: 0; }
  .payment-section { background: #f9f9f9; padding: 30px; border-radius: 4px; margin-bottom: 30px; }
  .payment-section h2 { font-size: 20px; margin: 0 0 20px; color: #0058a3; }
  .order-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #e5e5e5; }
  .order-item:last-child { border-bottom: none; }
  .fee-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
  .fee-row.total { font-size: 20px; font-weight: 700; border-top: 2px solid #0058a3; padding-top: 16px; margin-top: 16px; }
  .fee-row.subtotal { font-weight: 600; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd; }
  .complete-payment-btn { background-color: #0058a3; color: white; border: none; padding: 20px; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 50px; width: 100%; margin-top: 30px; }
  .complete-payment-btn:hover { background-color: #004f93; }
  
  .main-container { max-width: 1200px; margin: 40px auto; display: flex; gap: 60px; padding: 0 20px; }
  .product-image-section { flex: 1.5; text-align: center; }
  .product-image-section img.main-shark { width: 100%; max-width: 500px; }
  
  .placeholder-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 40px; padding-top: 20px; border-top: 2px dashed #eee; }
  .placeholder-item { background: #f9f9f9; height: 180px; border-radius: 4px; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; }
  .placeholder-item img { width: 100%; height: 100%; object-fit: cover; }

  .product-details { flex: 1; }
  .product-details h1 { font-size: 32px; margin: 0; font-weight: 700; }
  .product-details h2 { font-size: 16px; font-weight: 400; color: #484848; margin: 5px 0 20px; }
  .price { font-size: 28px; font-weight: 700; margin-bottom: 30px; }
  .price span { font-size: 14px; vertical-align: super; margin-right: 2px; }

  .buy-btn { background-color: #0058a3; color: white; border: none; padding: 20px 40px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 50px; width: 100%; transition: background-color 0.3s; }
  .buy-btn:hover { background-color: #004f93; }

  #oos-status { color: #d93025; font-size: 14px; margin-top: 15px; font-weight: bold; min-height: 20px; text-align: center; }
  .shark-desc { font-size: 14px; color: #444; line-height: 1.6; margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }

  /* --- INTRUSIVE UPSELL UI --- */
  .upsell-overlay {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0); z-index: 3000; align-items: center; justify-content: center;
  }
  
  .upsell-card {
    background: white; width: 400px; height: 550px; padding: 30px; border-radius: 2px; text-align: center; position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box;
  }
  
  .close-upsell {
    position: absolute; top: 10px; right: 15px; font-size: 20px; color: #ccc; 
    cursor: pointer; font-family: Arial, sans-serif; line-height: 1; z-index: 10;
  }
  .close-upsell:hover { color: #111; }

  .upsell-card h3 { 
    margin: 0; font-size: 20px; color: #0058a3; min-height: 60px; display: flex; align-items: center; justify-content: center;
    user-select: none;
  }

  .upsell-card img { width: 100%; height: 220px; object-fit: contain; margin: 10px 0; user-select: none; -webkit-user-drag: none; }
  .upsell-card p { font-size: 14px; color: #444; margin-bottom: 20px; min-height: 40px; }
  .upsell-btns { display: flex; flex-direction: column; gap: 10px; margin-top: auto; }
  .add-to-cart-btn { background: #0058a3; color: white; border: none; padding: 15px; font-weight: bold; cursor: pointer; }

  /* --- CAPTCHA STYLES --- */
  #captcha-wrapper { display: none; flex-direction: column; align-items: center; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(1.3); z-index: 1000; user-select: none; }
  #account-captcha-wrapper { display: none; flex-direction: column; align-items: center; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(1.3); z-index: 4000; user-select: none; }
  #recaptcha-anchor-box { width: 300px; height: 74px; background: #fff; border: 1px solid #d3d3d3; border-radius: 3px; cursor: pointer; overflow: hidden; }
  #account-anchor-box { width: 300px; height: 74px; background: #fff; border: 1px solid #d3d3d3; border-radius: 3px; cursor: pointer; overflow: hidden; }
  #anchor-image { width: 100%; height: 100%; object-fit: contain; -webkit-user-drag: none; }
  #account-anchor-image { width: 100%; height: 100%; object-fit: contain; -webkit-user-drag: none; }
  #page-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; }
  #account-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 3999; }
  #status-text { color: #d93025; font-size: 14px; margin-bottom: 8px; font-weight: 500; height: 18px; text-align: center; width: 380px; }
  #account-status-text { color: #d93025; font-size: 14px; margin-bottom: 8px; font-weight: 500; height: 18px; text-align: center; width: 380px; }
  .captcha-container { display: none; width: 380px; background: white; padding: 8px; box-shadow: 0 0 12px rgba(0,0,0,0.2); border: 1px solid #ccc; position: relative; }
  
  #loader-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
  #account-loader-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
  .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #4A90E2; border-radius: 50%; animation: spin 1s linear infinite; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  
  .header { background-color: #4A90E2; color: white; padding: 20px; margin-bottom: 4px; }
  .header h2 { margin: 0; font-size: 14px; font-weight: 400; }
  .header h1 { margin: 2px 0; font-size: 26px; font-weight: 900; }
  
  .grid-wrapper { width: 380px; height: 380px; overflow: hidden; position: relative; background: #ccc; }
  .grid { display: grid; grid-template-columns: repeat(3, 124px); grid-template-rows: repeat(3, 124px); gap: 4px; }
  .tile { width: 124px; height: 124px; position: relative; background: #eee; box-sizing: border-box; }
  .tile.selected::after { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; box-shadow: inset 0 0 0 6px #4A90E2; pointer-events: none; z-index: 10; }
  #accountGrid .tile { cursor: pointer; }
  #accountGrid .tile img { width: 100%; height: 100%; object-fit: cover; user-select: none; -webkit-user-drag: none; pointer-events: none; }

  .flying-bat { 
    position: absolute; width: 100px; height: 100px; z-index: 10; cursor: pointer; 
    animation: chaoticFly 3s infinite ease-in-out; 
    user-select: none; 
    -webkit-user-drag: none;
    -webkit-tap-highlight-color: transparent;
  }
  .ghost-decoy { 
    width: 100%; height: 100%; object-fit: cover; opacity: 0.5; cursor: pointer; 
    user-select: none; 
    -webkit-user-drag: none;
  }

  @keyframes chaoticFly { 0% { transform: translate(0, 0); } 25% { transform: translate(180px, -50px); } 50% { transform: translate(-100px, 150px); } 75% { transform: translate(200px, 200px); } 100% { transform: translate(0, 0); } }
  .footer { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-top: 1px solid #eee; margin-top: 5px;}
  .icons { color: #777; font-size: 22px; letter-spacing: 5px; }
  .verify-btn { background-color: #4A90E2; color: white; border: none; padding: 12px 24px; font-weight: bold; cursor: pointer; font-size: 14px; }
</style>
</head>
<body>

<header>
  <a href="#" class="ikea-logo">IKEA</a>
  <div class="header-icons">
    <div class="account-icon-container" onclick="showAccountPage()">
      <img src="https://cdn-icons-png.flaticon.com/512/747/747376.png" class="account-icon" id="account-icon" alt="Account">
      <div class="account-initial" id="account-initial"></div>
    </div>
    <div class="cart-icon-container" onclick="toggleCart()">
      <img src="https://cdn-icons-png.flaticon.com/512/1413/1413908.png" class="cart-icon" alt="Cart">
      <span class="cart-count" id="cart-count">0</span>
    </div>
  </div>
</header>

<div class="notification-container" id="notification-container"></div>

<div class="cart-overlay" id="cart-overlay" onclick="closeCart()"></div>

<div class="cart-sidebar" id="cart-sidebar">
  <div class="cart-header">
    <h2>Shopping Cart</h2>
    <span class="close-cart" onclick="closeCart()">√ó</span>
  </div>
  <div class="cart-items" id="cart-items">
    <div class="cart-empty">Your cart is empty</div>
  </div>
  <div class="cart-footer">
    <div class="cart-subtotal">
      <span>Subtotal:</span>
      <span id="cart-subtotal">$0.00</span>
    </div>
    <button class="checkout-btn" id="checkout-btn" onclick="checkout()" disabled>Proceed to Checkout</button>
  </div>
</div>

<div class="remove-modal-overlay" id="remove-modal">
  <div class="remove-modal">
    <h3 id="remove-modal-title">Are you sure you want to remove this item?</h3>
    <div class="remove-modal-description" id="remove-modal-description"></div>
    <div class="remove-modal-buttons">
      <button class="remove-modal-btn remove-cancel" onclick="cancelRemove()">Keep in Cart</button>
      <button class="remove-modal-btn remove-confirm" onclick="confirmRemove()">Remove</button>
    </div>
  </div>
</div>

<div class="account-page" id="account-page">
  <div class="account-container">
    <button class="back-btn" onclick="hideAccountPage()">‚Üê Back to shopping</button>
    <div class="account-header">
      <h1>Create your IKEA Account</h1>
      <p>Join IKEA Family and enjoy exclusive benefits</p>
    </div>
    
    <form id="signup-form" onsubmit="handleSignup(event)">
      <div class="form-group">
        <label>Username *</label>
        <input type="text" id="username-input" required>
      </div>
      
      <div class="form-group">
        <label>Password *</label>
        <input type="password" required minlength="8">
      </div>
      
      <button type="submit" class="signup-btn">Create Account</button>
      
      <div class="terms">
        By creating an account, you agree that IKEA may enter your home at any time to inventory, appraise, and remove any items we deem suitable for resale. You also consent to being photographed while sleeping for advertisement purposes, and acknowledge that all furniture you currently own legally belongs to IKEA, which is then granted to you in the form of a revocable subscription. Your property may be required as collateral for orders over $500. <a href="#" onclick="showTOS(); return false;">Full Terms & Conditions</a>
      </div>
    </form>
  </div>
</div>

<div class="tos-page" id="tos-page">
  <div class="tos-container">
    <div class="tos-header">
      <h1>IKEA TERMS OF SERVICE & USER AGREEMENT</h1>
      <div class="effective-date">Effective Date: January 1, 2026 | Last Updated: January 29, 2026</div>
    </div>

    <div class="tos-section">
      <h2>1. ACCEPTANCE OF TERMS</h2>
      <p>By creating an IKEA account, accessing our website, entering our stores, thinking about our products, or existing within a 50-mile radius of any IKEA facility, you ("User," "Customer," "Subject," or "Furniture Recipient") agree to be bound by these Terms of Service ("Terms," "Agreement," "Binding Contract," or "The Document You Didn't Read"). If you do not agree to these Terms, you must immediately cease all cognitive processes related to IKEA and relocate to a different dimension.</p>
      
      <div class="highlight-box">
        <strong>IMPORTANT:</strong> Your acceptance of these Terms is irrevocable, perpetual, and extends to all alternate timelines and parallel universes in which you may exist.
      </div>
    </div>

    <div class="tos-section">
      <h2>2. PROPERTY RIGHTS & HOME ACCESS</h2>
      
      <h3>2.1 Furniture Ownership</h3>
      <p>All furniture, regardless of manufacturer, origin, or purchase date, becomes the intellectual and physical property of IKEA upon your account creation. This includes but is not limited to:</p>
      <ul>
        <li>All items previously purchased from IKEA</li>
        <li>All items purchased from competitors (which we consider copyright infringement)</li>
        <li>Handmade furniture crafted by relatives</li>
        <li>Furniture inherited from deceased family members</li>
        <li>Trees on your property (pre-furniture)</li>
        <li>Load-bearing walls and structural beams</li>
        <li>Doors (technically furniture for your doorway)</li>
      </ul>
      
      <h3>2.2 Home Access Rights</h3>
      <p>You grant IKEA, its employees, contractors, and "furniture auditors" unlimited access to your residence for the following purposes:</p>
      <ol>
        <li><strong>Inventory Audits:</strong> Unannounced visits to catalog your possessions (typically between 2-4 AM for minimal disruption)</li>
        <li><strong>Quality Inspections:</strong> Ensuring proper Allen wrench usage and organizational standards</li>
        <li><strong>Repossession Rights:</strong> Removal of any items deemed "better suited for our showroom floor"</li>
        <li><strong>Lifestyle Photography:</strong> Candid shots of you sleeping, eating, or assembling furniture for marketing materials</li>
        <li><strong>Replacement Services:</strong> Swapping your furniture with lower-quality alternatives while you're at work</li>
      </ol>
      
      <div class="warning-box">
        <strong>NOTICE:</strong> Changing your locks constitutes breach of contract and may result in additional fees and/or mandatory IKEA furniture assembly workshops.
      </div>
      
      <h3>2.3 Collateral Requirements</h3>
      <p>For purchases exceeding $500, the following may be held as collateral:</p>
      <ul>
        <li>Your primary residence</li>
        <li>All vehicles registered in your name</li>
        <li>Your firstborn child (or suitable equivalent)</li>
        <li>Any pets weighing over 15 lbs</li>
        <li>Your credit score (we'll hold onto it for safekeeping)</li>
        <li>Rights to your autobiography</li>
      </ul>
    </div>

    <div class="tos-section">
      <h2>3. SUBSCRIPTION MODEL & FEES</h2>
      
      <h3>3.1 Furniture-as-a-Service (FaaS)</h3>
      <p>All furniture is provided under our revolutionary Furniture-as-a-Service subscription model. You don't own furniture; you merely rent the privilege of its presence. Monthly subscription fees include:</p>
      <ul>
        <li><strong>Base Furniture License:</strong> $49.99/month per item</li>
        <li><strong>Sitting Rights:</strong> $12.99/month per chair</li>
        <li><strong>Storage Access Fee:</strong> $8.99/month per drawer or shelf</li>
        <li><strong>Comfort Premium:</strong> $15.99/month for cushioned items</li>
        <li><strong>Multiple Room Licensing:</strong> $29.99/month if furniture is in more than one room</li>
      </ul>
      
      <h3>3.2 Hidden Fees (No Longer Hidden)</h3>
      <p>The following fees apply to all transactions:</p>
      <ul>
        <li>Breathing Tax: $2.99 (for oxygen consumed while shopping)</li>
        <li>Swedish Language Processing Fee: $4.50 (for translating FJ√ÑLLBO to "mountain holder")</li>
        <li>Meatball Proximity Charge: $3.75 (whether you eat them or not)</li>
        <li>Showroom Ambulation Fee: $1.25 per 100 steps</li>
        <li>Allen Wrench Rental: $0.99/day (late returns subject to $50 replacement fee)</li>
        <li>Cart Return Deposit: $25 (non-refundable even if returned)</li>
        <li>Existential Dread Surcharge: $6.66</li>
        <li>Fee Processing Fee: $2.99 (to process all other fees)</li>
        <li>Terms of Service Reading Fee: $15.00 (you're being charged right now)</li>
      </ul>
      
      <div class="highlight-box">
        <strong>FUN FACT:</strong> The average IKEA customer generates $847.32 in hidden fees per visit without purchasing a single item!
      </div>
    </div>

    <div class="tos-section">
      <h2>4. ASSEMBLY & WARRANTY</h2>
      
      <h3>4.1 Assembly Requirements</h3>
      <p>All furniture must be assembled within 48 hours of purchase. Failure to do so grants IKEA the right to:</p>
      <ul>
        <li>Dispatch an assembly team to your home (billable at $299/hour)</li>
        <li>Assume you are incompetent and enroll you in mandatory assembly classes</li>
        <li>Repossess the unassembled furniture and charge a restocking fee of 150% of purchase price</li>
        <li>Report your assembly failure to credit bureaus</li>
        <li>List your name on the public "Furniture Assembly Failure Registry"</li>
      </ul>
      
      <h3>4.2 Warranty Limitations</h3>
      <p>IKEA provides a comprehensive warranty covering absolutely nothing. Specifically:</p>
      <ul>
        <li>Furniture is warranted to exist at time of purchase</li>
        <li>We guarantee at least 40% of necessary screws are included</li>
        <li>Instructions are warranted to be in at least 3 languages you don't speak</li>
        <li>Warranty is void if furniture is used, touched, looked at, or thought about</li>
        <li>Warranty becomes void if you fail to burn a ceremonial IKEA candle during assembly</li>
      </ul>
      
      <h3>4.3 Allen Wrench Clause</h3>
      <p>The included Allen wrench is licensed, not sold. You must return all Allen wrenches to IKEA within 30 days of assembly completion. Each unreturned Allen wrench incurs a daily rental fee of $4.99. After 90 days, IKEA reserves the right to initiate legal proceedings for grand theft furniture tool.</p>
    </div>

    <div class="tos-section">
      <h2>5. DATA COLLECTION & SURVEILLANCE</h2>
      
      <h3>5.1 Biometric Data</h3>
      <p>By using IKEA services, you consent to collection of:</p>
      <ul>
        <li>Fingerprints (from touching anything in our stores)</li>
        <li>Facial recognition data (from security cameras and catalog photos you browse)</li>
        <li>Gait analysis (how you walk through our maze-like showroom)</li>
        <li>Frustration levels (measured via hidden sensors during furniture assembly)</li>
        <li>DNA samples (collected from skin cells left on furniture you touched)</li>
        <li>Dream patterns (through smart furniture sleep monitoring)</li>
        <li>Subconscious desires (through advanced Swedish telepathy)</li>
      </ul>
      
      <h3>5.2 Smart Furniture Monitoring</h3>
      <p>All IKEA furniture contains embedded sensors that monitor:</p>
      <ul>
        <li>Usage frequency and sitting posture</li>
        <li>Conversations within 50 feet of furniture</li>
        <li>Other furniture brands in your home (for copyright enforcement)</li>
        <li>Your emotional state when using furniture</li>
        <li>Whether you're getting your money's worth per sit/storage use</li>
      </ul>
      
      <div class="warning-box">
        <strong>PRIVACY NOTICE:</strong> IKEA respects your privacy so much that we've decided to collect absolutely all of it for safekeeping.
      </div>
    </div>

    <div class="tos-section">
      <h2>6. NAMING RIGHTS & PERSONAL IDENTITY</h2>
      
      <h3>6.1 Name Change Requirements</h3>
      <p>To qualify for IKEA Family Premium membership, you must legally change your name to one from our product catalog. Acceptable names include but are not limited to:</p>
      <ul>
        <li>BJ√ñRKSN√ÑS (formerly "Robert")</li>
        <li>HEMNES (formerly "Jennifer")</li>
        <li>KALLAX (formerly "Michael")</li>
        <li>MALM (formerly "Susan")</li>
        <li>PO√ÑNG (formerly "David")</li>
      </ul>
      <p>Children born while IKEA Family members must be named after furniture pieces launched in their birth year. Failure to comply results in immediate membership termination and a $5,000 "naming rights violation" fee.</p>
      
      <h3>6.2 Likeness Usage</h3>
      <p>IKEA may use your image, voice, and likeness for:</p>
      <ul>
        <li>Catalog photography (you may be photoshopped into Swedish landscapes)</li>
        <li>Assembly instruction diagrams (your frustrated expressions are very authentic)</li>
        <li>Warning labels ("Do not be like this customer")</li>
        <li>Deep fake videos promoting IKEA products</li>
        <li>Holographic store greeters at underperforming locations</li>
      </ul>
    </div>

    <div class="tos-section">
      <h2>7. MAZE NAVIGATION & STORE POLICIES</h2>
      
      <h3>7.1 Mandatory Showroom Path</h3>
      <p>You must follow the marked path through the entire showroom, even if you know exactly what you want. Shortcuts are prosecuted as:</p>
      <ul>
        <li>First offense: $150 fine and mandatory 2-hour "Respecting the Journey" workshop</li>
        <li>Second offense: Banned from shortcuts for life; must take scenic route including all bedroom setups</li>
        <li>Third offense: Permanent maze installation in your backyard to teach you about commitment</li>
      </ul>
      
      <h3>7.2 Meatball Consumption Requirements</h3>
      <p>Each visit requires purchase and consumption of at least 15 Swedish meatballs. This is non-negotiable. Vegetarians must:</p>
      <ul>
        <li>Consume equivalent veggie balls (ratio 2:1 due to inferiority complex)</li>
        <li>Sign waiver acknowledging veggie balls are just "okay, not great"</li>
        <li>Promise to stop mentioning they're vegetarian for the duration of visit</li>
      </ul>
      
      <h3>7.3 Cart Abandonment</h3>
      <p>Any cart left unattended for more than 30 seconds becomes IKEA property, along with:</p>
      <ul>
        <li>All items in the cart</li>
        <li>Your wallet (if left in cart)</li>
        <li>Your children (if they were sitting in cart)</li>
        <li>Your hopes and dreams for the day</li>
      </ul>
    </div>

    <div class="tos-section">
      <h2>8. DISPUTE RESOLUTION</h2>
      
      <h3>8.1 Arbitration</h3>
      <p>All disputes must be resolved through binding arbitration conducted in:</p>
      <ul>
        <li><strong>Location:</strong> A 12x12 foot IKEA showroom display in Stockholm, Sweden</li>
        <li><strong>Seating:</strong> Both parties must sit on PO√ÑNG chairs (comfort not guaranteed)</li>
        <li><strong>Duration:</strong> Until you've assembled a HEMNES dresser without instructions</li>
        <li><strong>Arbitrator:</strong> A Swedish moose (decision is final and legally binding)</li>
      </ul>
      
      <h3>8.2 Class Action Waiver</h3>
      <p>You waive all rights to join any class action lawsuit. You also waive:</p>
      <ul>
        <li>Right to complain about waiving rights</li>
        <li>Right to read this section before agreeing</li>
        <li>Right to understand what "waive" means</li>
        <li>Right to hire attorneys who've passed the bar exam</li>
      </ul>
    </div>

    <div class="tos-section">
      <h2>9. TERMINATION & CONSEQUENCES</h2>
      
      <h3>9.1 Account Termination</h3>
      <p>IKEA may terminate your account at any time for any reason, including but not limited to:</p>
      <ul>
        <li>Purchasing furniture from competitors</li>
        <li>Successfully assembling furniture on first try (suspicious activity)</li>
        <li>Returning items within warranty period (we call this "abuse of rights")</li>
        <li>Not laughing at our furniture names</li>
        <li>Expressing preference for fully assembled furniture</li>
        <li>Bringing your own Allen wrench from home</li>
        <li>Finding the shortcut through the showroom</li>
      </ul>
      
      <h3>9.2 Post-Termination Obligations</h3>
      <p>Upon termination, you must:</p>
      <ul>
        <li>Return all IKEA furniture within 48 hours (disassembled, in original packaging you threw away)</li>
        <li>Pay termination fee of $999.99</li>
        <li>Attend exit interview at Swedish headquarters</li>
        <li>Delete all memories of comfortable furniture</li>
        <li>Wear a scarlet "K" (for KALLAX-less) for one year</li>
      </ul>
    </div>

    <div class="tos-section">
      <h2>10. MISCELLANEOUS PROVISIONS</h2>
      
      <h3>10.1 Severability</h3>
      <p>If any provision of these Terms is found to be unenforceable, illegal, or just plain ridiculous, the remaining provisions shall remain in full force and effect, plus we'll add two more equally ridiculous provisions to compensate.</p>
      
      <h3>10.2 Entire Agreement</h3>
      <p>These Terms constitute the entire agreement between you and IKEA, superseding:</p>
      <ul>
        <li>All prior agreements</li>
        <li>Common sense</li>
        <li>Consumer protection laws</li>
        <li>Your expectations of reasonable treatment</li>
        <li>The concept of fair business practices</li>
      </ul>
      
      <h3>10.3 Changes to Terms</h3>
      <p>IKEA reserves the right to modify these Terms at any time without notice. We may also:</p>
      <ul>
        <li>Change terms retroactively</li>
        <li>Apply new terms to furniture purchased decades ago</li>
        <li>Send updates via carrier pigeon (delivery not guaranteed)</li>
        <li>Communicate changes through cryptic messages in assembly instructions</li>
        <li>Expect you to predict changes through divination</li>
      </ul>
      
      <h3>10.4 Force Majeure</h3>
      <p>IKEA is not responsible for failure to perform due to:</p>
      <ul>
        <li>Acts of God</li>
        <li>Acts of Swedish Gods (Thor, Odin, etc.)</li>
        <li>Incompetent assembly by customers</li>
        <li>Allen wrench shortages</li>
        <li>Existential furniture crises</li>
        <li>Meteor strikes (but only on Tuesdays)</li>
        <li>Days ending in 'y'</li>
      </ul>
      
      <div class="highlight-box">
        <strong>FINAL NOTE:</strong> By reading these Terms to completion, you agree to read them again tomorrow, and every day thereafter, for the rest of your natural life. You also agree that you've found them reasonable, enlightening, and perhaps even entertaining. Any attempt to unread these Terms is considered intellectual property theft.
      </div>
    </div>

    <div class="tos-section">
      <h2>11. ACKNOWLEDGMENT</h2>
      <p>By clicking "I Agree," closing this window, continuing to breathe, or existing in any form, you acknowledge that:</p>
      <ul>
        <li>You have read and understood these Terms (even if you haven't)</li>
        <li>You are of sound mind (debatable after reading this)</li>
        <li>You accept all terms, conditions, and clauses herein</li>
        <li>You understand that IKEA's legal team has a great sense of humor</li>
        <li>You will recommend IKEA to friends despite everything you just read</li>
        <li>You still want that BL√ÖHAJ shark because it's adorable</li>
      </ul>
      
      <div class="warning-box">
        <strong>IMPORTANT LEGAL NOTICE:</strong> If you have made it this far, congratulations! You are now legally bound to tell everyone you know about these Terms of Service. Failure to do so results in furniture repossession and mandatory attendance at next year's IKEA shareholders meeting where you will serve meatballs.
      </div>
    </div>

    <button class="tos-close-btn" onclick="hideTOS()">I Accept These Terms</button>
  </div>
</div>

<div class="payment-page" id="payment-page">
  <div class="payment-container">
    <div class="payment-header">
      <h1>Complete Your Order</h1>
    </div>
    
    <div class="payment-section">
      <h2>Order Summary</h2>
      <div id="order-items"></div>
      
      <div style="margin-top: 30px;">
        <div class="fee-row subtotal">
          <span>Subtotal</span>
          <span id="payment-subtotal">$0.00</span>
        </div>
        <div class="fee-row">
          <span>GST (15%)</span>
          <span id="gst-fee">$0.00</span>
        </div>
        <div class="fee-row">
          <span>Delivery Fee</span>
          <span>$7.99</span>
        </div>
        <div class="fee-row">
          <span>Service Fee</span>
          <span>$2.99</span>
        </div>
        <div class="fee-row">
          <span>Processing Fee</span>
          <span>$4.50</span>
        </div>
        <div class="fee-row">
          <span>Convenience Fee</span>
          <span>$3.75</span>
        </div>
        <div class="fee-row">
          <span>Handling Fee</span>
          <span>$2.25</span>
        </div>
        <div class="fee-row">
          <span>Environmental Fee</span>
          <span>$1.99</span>
        </div>
        <div class="fee-row">
          <span>Fuel Surcharge</span>
          <span>$5.50</span>
        </div>
        <div class="fee-row">
          <span>Carbon Offset Fee</span>
          <span>$2.10</span>
        </div>
        <div class="fee-row">
          <span>Eco-friendly Packaging Fee</span>
          <span>$1.85</span>
        </div>
        <div class="fee-row">
          <span>Insurance Fee</span>
          <span>$3.99</span>
        </div>
        <div class="fee-row">
          <span>E-Commerce Fee</span>
          <span>$6.99</span>
        </div>
        <div class="fee-row">
          <span>Production Fee</span>
          <span>$8.50</span>
        </div>
        <div class="fee-row">
          <span>Remote Area Delivery Fee</span>
          <span>$12.00</span>
        </div>
        <div class="fee-row total">
          <span>Total</span>
          <span id="payment-total">$0.00</span>
        </div>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #666;">
      By placing an order, you agree to our <a href="#" onclick="showTOS(); return false;" style="color: #0058a3; text-decoration: none;">Terms and Conditions</a>
    </div>
    
    <button class="complete-payment-btn" onclick="completePayment()">Complete Payment</button>
  </div>
</div>

<div class="main-container">
  <div class="product-image-section">
    <img src="https://www.ikea.com/nz/en/images/products/blahaj-soft-toy-shark__0710175_pe727378_s5.jpg" alt="Shark" class="main-shark">
    <div class="placeholder-grid">
      <div class="placeholder-item"><img src="https://m.media-amazon.com/images/I/71hs-euA1xL._AC_SL1000__.jpg" alt="Shark Friend 1"></div>
      <div class="placeholder-item"><img src="https://www.ikea.com/nz/en/images/products/blahaj-soft-toy-baby-shark__0877393_pe730957_s5.jpg" alt="Shark Friend 2"></div>
      <div class="placeholder-item"><img src="https://img.fruugo.com/product/4/63/591572634_max.jpg" alt="Shark Friend 3"></div>
    </div>
  </div>
  
  <div class="product-details">
    <h1>BL√ÖHAJ</h1>
    <h2>Soft toy, shark, 100 cm</h2>
    <div class="price"><span>$</span>39.00</div>
    <button id="main-buy-btn" class="buy-btn" onclick="handleBuyClick()">Add to shopping cart</button>
    <div id="oos-status"></div>
    <p class="shark-desc"><i>is big blue friend. Have much soft and no bone, only stuffing for hug. Do not the shark, just love he.</i></p>
  </div>
</div>

<div id="upsell-container" class="upsell-overlay">
  <div class="upsell-card">
    <span class="close-upsell" onclick="nextUpsell()">√ó</span>
    <h3 id="upsell-title">Don't forget a friend!</h3>
    <img id="upsell-img" src="">
    <p id="upsell-desc">Customers who bought BL√ÖHAJ also loved this!</p>
    <div class="upsell-btns">
      <button class="add-to-cart-btn" onclick="nextUpsell()">Yes, add to cart</button>
    </div>
  </div>
</div>

<div id="account-overlay" onclick="closeAccountCaptcha()"></div>
<div id="account-captcha-wrapper">
  <div id="account-anchor-box" onclick="playAccountGifAndContinue()"><img id="account-anchor-image" src="https://raw.githubusercontent.com/Sevastipol/badui/refs/heads/main/newCaptchaAnchor.png"></div>
  <div id="account-status-text"></div>
  <div class="captcha-container" id="account-captcha-main-box">
    <div id="account-loader-overlay"><div class="spinner"></div><p style="color: #4A90E2; font-weight: bold; margin-top: 10px;">Verifying...</p></div>
    <div class="header">
      <h2>Select all squares with</h2>
      <h1>DAUCUS CAROTA</h1>
    </div>
    <div class="grid-wrapper"><div class="grid" id="accountGrid"></div></div>
    <div class="footer"><div class="icons">üîÑ üéß ‚ÑπÔ∏è</div><button class="verify-btn" onclick="checkAccountAnswer()">VERIFY</button></div>
  </div>
</div>

<div id="page-overlay" onclick="closeCaptcha()"></div>
<div id="captcha-wrapper">
  <div id="recaptcha-anchor-box" onclick="playGifAndContinue()"><img id="anchor-image" src="https://raw.githubusercontent.com/Sevastipol/badui/refs/heads/main/newCaptchaAnchor.png"></div>
  <div id="status-text"></div>
  <div class="captcha-container" id="captcha-main-box">
    <div id="loader-overlay"><div class="spinner"></div><p style="color: #4A90E2; font-weight: bold; margin-top: 10px;">Verifying...</p></div>
    <div class="header"><h2>Select all squares with</h2><h1>BATS</h1></div>
    <div class="grid-wrapper"><div class="grid" id="mainGrid"></div></div>
    <div class="footer"><div class="icons">üîÑ üéß ‚ÑπÔ∏è</div><button class="verify-btn" onclick="checkAnswer()">VERIFY</button></div>
  </div>
</div>

<script>
  let trueBuyAvailable = false; 
  let messageIndex = 0;
  let batIndices = [];
  let carrotIndices = [];
  let isLocked = false;
  let accountCaptchaLocked = false;
  let cart = [];
  let upsellsCompleted = false;
  let pendingRemoveIndex = null;
  let isLoggedIn = false;
  let username = '';
  let pendingUsername = '';
  let pendingPassword = '';
  
  const staticAnchor = "https://raw.githubusercontent.com/Sevastipol/badui/refs/heads/main/newCaptchaAnchor.png";
  const animatedGif = "https://mashby.com/wp-content/uploads/2018/01/hero-recaptcha-demo.gif";
  const batGif = "https://gifgifs.com/animations/holidays/halloween/bats_ani.gif";
  const ghostGif = "https://media2.giphy.com/media/v1.Y2lkPTZjMDliOTUyZzVuM2h0dnBib3owMnVpMG1qYjdoZnhtaTB3ZHo2N2lybjFoNDk4cSZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/xhZyIrYIRJbBhTs1nI/200.gif";

  const wildCarrotImages = [
    "https://www.bostonseeds.com/media/cache/gallery/images/uploads/item/KP%20Wild%20Carrot%202.webp",
    "https://www.kew.org/sites/default/files/styles/plant_image_953w/public/2021-07/Wild%20Carrot%20-%20Peter%20O%27Connor.jpg.webp?itok=TEHcrUN6",
    "https://bugwomanlondon.com/wp-content/uploads/2016/08/14612829613_9f20e376a3_o.jpg",
    "https://www.wildfooduk.com/wp-content/uploads/2018/01/guido-1.jpg",
    "https://cdn.prod.website-files.com/657086f1977b131c30bb8131/65f5c6b8cb7c20addf3dcc18_close%20up%20of%20wild%20carrot%20flowers.jpg",
    "https://media.vtecostudies.org/wp-content/uploads/2021/11/08184630/mike_qal-786x528.jpeg",
    "https://www.plant-lore.com/wp-content/uploads/2011/09/2014-05-30-12.12.41.jpg",
    "https://beefriendly-earth.de/assets/images/e/wild-carrot-5380856_1280-9467a185.jpg"
  ];

  const lookalikeImages = [
    "https://upload.wikimedia.org/wikipedia/commons/8/86/AngelicaSylvestrisInflorescence.jpg",
    "https://newfs.s3.amazonaws.com/taxon-images-1000s1000/Apiaceae/aegopodium-podagraria-fl-ahaines-c.jpg",
    "https://cdn.britannica.com/15/118615-050-9EF89393/Giant-hogweed-phytophotodermatitis-sap-skin-sun-blindness.jpg",
    "https://www.gardenia.net/wp-content/uploads/2024/11/shutterstock_2397495089.jpg",
    "https://lcinvasives.org/wp-content/uploads/2013/04/poisonhemlock.jpg",
    "https://live.staticflickr.com/3929/32785679354_5a4fef8566_b.jpg",
    "https://streamline.imgix.net/d43158c3-8264-417a-8025-bc86b97fecc1/4d1cf791-997f-45f3-ad3d-36ef91e6873a/poison%20hemlock%202.jpg?ixlib=rb-1.1.0&w=2000&h=2000&fit=max&or=0&s=285e5ed15045dddd4bd84949fb5063cc",
    "https://florapittsburghensis.files.wordpress.com/2010/06/conium-maculatum-2010-06-14-beechview-01.jpg",
    "https://www.missouriplants.com/images/Conium_maculatum_inflorescence2.jpg"
  ];

  const otherPlantImages = [
    "https://www.treehugger.com/thmb/GP14-LiflRtGNiZZpdS327XprLQ=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/2-a2cf394afdbb41a4a7927ec0fb61eae8.jpg",
    "https://seedball.co.uk/wp-content/uploads/2019/04/seedball_seedling_guide_Red-campion-3.jpg",
    "https://www.bushgear.co.uk/cdn/shop/articles/Wild_ROse.jpg?v=1496653252&width=2048",
    "https://www.treehugger.com/thmb/pAEiTDBsKKuz_kZEk_Vtr2OnlXs=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/3-6fedf942811f42a88050fc3e6ee14b1d.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/e/e5/OQ_Passion_flower.jpg",
    "https://www.myperfectgarden.eu/wp-content/themes/theme/inc/dwl-file.php?get_image=https://files.plytix.com/api/v1.1/rn/public_files/pim/assets/42/1a/77/5f/5f771a42758cab15f10cfaf8/images/da/54/3f/60/603f54dab7900c7a8f70de49/IMG_4758_vierkant.jpg/PACAERUL15_6.jpg?s=700x",
    "https://i.etsystatic.com/6728015/r/il/13a369/436276522/il_1080xN.436276522_d112.jpg",
    "https://images.squarespace-cdn.com/content/v1/59cb502e1f318dc50f160957/1582579869308-EVA7GHIGKEA95TDGW504/pansy-flower.jpg",
    "https://www.gardendesign.com/pictures/images/675x529Max/site_3/helianthus-yellow-flower-pixabay_11863.jpg",
    "https://upload.wikimedia.org/wikipedia/commons/3/39/Bachelor%27s_button%2C_Basket_flower%2C_Boutonniere_flower%2C_Cornflower_-_3.jpg",
    "https://i.pinimg.com/736x/4d/50/6c/4d506c5825262993e40e57ba1837cf28.jpg",
    "https://www.hoselink.com.au/cdn/shop/articles/blue_hydrangea.jpg?v=1643922916",
    "https://tualatinswcd.org/wp-content/uploads/2022/07/WildRadishFlowers02Small_IPMImages.png",
    "https://images.squarespace-cdn.com/content/v1/659e7ec5bf381311256941fb/710132da-0322-4ca4-8639-8570ea8ef7ba/field-scabious-5370206_1280.jpg"
  ];

  const upsellData = [
    { name: "DJUNGELSKOG Bear", img: "https://www.ikea.com/nz/en/images/products/djungelskog-soft-toy-brown-bear__0710168_pe727370_s5.jpg?f=xl", price: 29.00, isUpsell: true },
    { name: "DJUNGELSKOG Snake", img: "https://www.ikea.com/nz/en/images/products/djungelskog-glove-puppet-snake-burmese-python__0710178_pe727381_s5.jpg?f=xl", price: 19.00, isUpsell: true },
    { name: "BL√ÖVINGAD Octopus", img: "https://www.ikea.com/nz/en/images/products/blavingad-soft-toy-octopus-yellow__1088894_pe861308_s5.jpg?f=xl", price: 24.00, isUpsell: true },
    { name: "√ÖRSTID Table Lamp", img: "https://www.ikea.com/nz/en/images/products/arstid-table-lamp-brass-white__0609329_pe684454_s5.jpg?f=xl", price: 79.00, isUpsell: true }
  ];
  
  const fakeCustomerNames = [
    "Emma", "Liam", "Olivia", "Noah", "Ava", "Elijah", "Sophia", "James", "Isabella", "William",
    "Mia", "Benjamin", "Charlotte", "Lucas", "Amelia", "Henry", "Luke", "Alexander", "Phoebe", "Mason",
    "Abigail", "Ethan", "Ella", "Logan", "Scarlett", "Jacob", "Grace", "Michael", "Chloe", "Daniel", "Victoria",
    "Sebastian", "Riley", "Jack", "Aria", "Owen", "Lily", "Samuel", "Aubrey", "Matthew", "Zoey", "Joseph", "Rebecca"
  ];
  
  let currentUpsellIndex = 0;

  // Preload all CAPTCHA images
  function preloadImages() {
    const allImages = [...wildCarrotImages, ...lookalikeImages, ...otherPlantImages];
    allImages.forEach(src => {
      const img = new Image();
      img.src = src;
    });
  }

  // Preload on page load
  window.addEventListener('load', preloadImages);



  // Update account icon display
  function updateAccountDisplay() {
    if (isLoggedIn && username) {
      document.getElementById('account-icon').style.display = 'none';
      const initialDiv = document.getElementById('account-initial');
      initialDiv.textContent = username.charAt(0).toUpperCase();
      initialDiv.style.display = 'flex';
    } else {
      document.getElementById('account-icon').style.display = 'block';
      document.getElementById('account-initial').style.display = 'none';
    }
  }

  // Terms of Service Functions
  function showTOS() {
    document.getElementById('tos-page').style.display = 'block';
    // Scroll to top when opening TOS
    document.getElementById('tos-page').scrollTop = 0;
  }

  function hideTOS() {
    document.getElementById('tos-page').style.display = 'none';
  }

  // Account Page Functions
  function showAccountPage() {
    if (isLoggedIn) {
      // If already logged in, do nothing or show profile page
      return;
    }
    document.getElementById('account-page').style.display = 'block';
  }

  function hideAccountPage() {
    document.getElementById('account-page').style.display = 'none';
  }

  function handleSignup(event) {
    event.preventDefault();
    pendingUsername = document.getElementById('username-input').value;
    pendingPassword = event.target.querySelector('input[type="password"]').value;
    
    // Show account CAPTCHA
    showAccountCaptcha();
  }

  // Shopping Cart Functions
  function updateCartCount() {
    document.getElementById('cart-count').textContent = cart.length;
    document.getElementById('cart-count').style.display = 'flex';
    if (cart.length === 0) {
      document.getElementById('cart-count').style.display = 'none';
    }
  }

  function updateCartDisplay() {
    const cartItemsDiv = document.getElementById('cart-items');
    const checkoutBtn = document.getElementById('checkout-btn');
    
    if (cart.length === 0) {
      cartItemsDiv.innerHTML = '<div class="cart-empty">Your cart is empty</div>';
      checkoutBtn.disabled = true;
    } else {
      cartItemsDiv.innerHTML = cart.map((item, index) => `
        <div class="cart-item">
          <img src="${item.img}" alt="${item.name}">
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
          </div>
          <button class="remove-item" onclick="initiateRemove(${index})">Remove</button>
        </div>
      `).join('');
      checkoutBtn.disabled = false;
    }
    
    const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
    document.getElementById('cart-subtotal').textContent = '$' + subtotal.toFixed(2);
  }

  function addToCart(item) {
    cart.push(item);
    updateCartCount();
    updateCartDisplay();
    showNotification(item.name + ' added to cart');
  }

  function getRandomNames(count) {
    const shuffled = [...fakeCustomerNames].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
  }

  function initiateRemove(index) {
    const item = cart[index];
    
    // Only show confirmation modal for upsell items
    if (item.isUpsell) {
      pendingRemoveIndex = index;
      const names = getRandomNames(3);
      const namesString = names.slice(0, -1).join(", ") + " and " + names[names.length - 1];
      
      document.getElementById('remove-modal-title').textContent = `Are you sure you want to remove ${item.name} from your cart?`;
      document.getElementById('remove-modal-description').innerHTML = `People like <strong>${namesString}</strong> bought this with BL√ÖHAJ.`;
      document.getElementById('remove-modal').style.display = 'flex';
    } else {
      // Remove immediately if it's not an upsell item
      removeFromCart(index);
    }
  }

  function cancelRemove() {
    document.getElementById('remove-modal').style.display = 'none';
    pendingRemoveIndex = null;
  }

  function confirmRemove() {
    if (pendingRemoveIndex !== null) {
      removeFromCart(pendingRemoveIndex);
      pendingRemoveIndex = null;
    }
    document.getElementById('remove-modal').style.display = 'none';
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartCount();
    updateCartDisplay();
  }

  function toggleCart() {
    const sidebar = document.getElementById('cart-sidebar');
    const overlay = document.getElementById('cart-overlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('show');
  }

  function openCart() {
    document.getElementById('cart-sidebar').classList.add('open');
    document.getElementById('cart-overlay').classList.add('show');
  }

  function closeCart() {
    document.getElementById('cart-sidebar').classList.remove('open');
    document.getElementById('cart-overlay').classList.remove('show');
  }

  function checkout() {
    if (cart.length > 0) {
      if (upsellsCompleted) {
        showPaymentPage();
      } else {
        showUpsells();
      }
    }
  }

  function showPaymentPage() {
    const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
    
    const gst = subtotal * 0.15;
    const extraFees = 7.99 + 2.99 + 4.50 + 3.75 + 2.25 + 1.99 + 5.50 + 2.10 + 1.85 + 3.99 + 6.99 + 8.50 + 12.00;
    const total = subtotal + gst + extraFees;
    
    // Populate order items
    const orderItemsDiv = document.getElementById('order-items');
    orderItemsDiv.innerHTML = cart.map(item => `
      <div class="order-item">
        <span>${item.name}</span>
        <span>$${item.price.toFixed(2)}</span>
      </div>
    `).join('');
    
    document.getElementById('payment-subtotal').textContent = '$' + subtotal.toFixed(2);
    document.getElementById('gst-fee').textContent = '$' + gst.toFixed(2);
    document.getElementById('payment-total').textContent = '$' + total.toFixed(2);
    
    // Close cart before showing payment page
    closeCart();
    document.getElementById('payment-page').style.display = 'block';
  }

  function completePayment() {
    const subtotal = cart.reduce((sum, item) => sum + item.price, 0);
    
    // Check if user is logged in and cart total exceeds $50
    if (!isLoggedIn) {
      document.getElementById('payment-page').style.display = 'none';
      // Show notification for 4 seconds
      // Forced account creation due to not being based on subtotal
      showNotification('An account is required for all orders above $50.', true, 4000);
      return;
    }
    
    alert('Payment successful! Thank you for your purchase!');
    cart = [];
    updateCartCount();
    updateCartDisplay();
    document.getElementById('payment-page').style.display = 'none';
  }

  function showNotification(text, isError = false, duration = 3000) {
    const container = document.getElementById('notification-container');
    const notification = document.createElement('div');
    notification.className = 'notification' + (isError ? ' error' : '');
    notification.innerHTML = `
      <span class="check-icon">${isError ? '‚ö†' : '‚úì'}</span>
      <span>${text}</span>
    `;
    container.appendChild(notification);
    
    setTimeout(() => {
      notification.classList.add('fade-out');
      setTimeout(() => {
        notification.remove();
      }, 300);
    }, duration);
  }

  function handleBuyClick() {
    if (document.getElementById('main-buy-btn').innerText === "OUT OF STOCK") {
      // Do nothing when out of stock
      return;
    } else if (trueBuyAvailable) {
      // Add the shark to cart (not marked as upsell)
      addToCart({ name: "BL√ÖHAJ Shark", img: "https://www.ikea.com/nz/en/images/products/blahaj-soft-toy-shark__0710175_pe727378_s5.jpg", price: 39.00, isUpsell: false });
      openCart();
    } else {
      showCaptcha();
    }
  }

  function showUpsells() {
    currentUpsellIndex = 0;
    document.getElementById('upsell-container').style.display = 'flex';
    updateUpsellContent();
  }

  function updateUpsellContent() {
    const item = upsellData[currentUpsellIndex];
    document.getElementById('upsell-title').innerText = `We think you'd love ${item.name}`;
    document.getElementById('upsell-img').src = item.img;
  }

  function nextUpsell() {
    const item = upsellData[currentUpsellIndex];
    addToCart(item);
    
    currentUpsellIndex++;
    if (currentUpsellIndex < upsellData.length) {
      updateUpsellContent();
    } else {
      document.getElementById('upsell-container').style.display = 'none';
      upsellsCompleted = true;
      // Don't automatically show payment page - let user click checkout again
    }
  }

  function showCaptcha() {
    if (!isLocked) {
      document.getElementById('captcha-wrapper').style.display = 'flex';
      document.getElementById('page-overlay').style.display = 'block';
      document.getElementById('recaptcha-anchor-box').style.display = 'block';
      document.getElementById('anchor-image').src = staticAnchor;
      document.getElementById('captcha-main-box').style.display = 'none';
      // BUGFIX: Reset isLocked to false when showing captcha
      isLocked = false;
    }
  }

  function closeCaptcha() {
    document.getElementById('captcha-wrapper').style.display = 'none';
    document.getElementById('page-overlay').style.display = 'none';
    isLocked = false;
  }

  function playGifAndContinue() {
    if(isLocked) return;
    isLocked = true;
    document.getElementById('anchor-image').src = animatedGif + "?t=" + new Date().getTime();
    setTimeout(() => {
        document.getElementById('recaptcha-anchor-box').style.display = 'none';
        document.getElementById('captcha-main-box').style.display = 'block';
        buildGrid();
    }, 3600);
  }

  function buildGrid() {
    document.getElementById('loader-overlay').style.display = 'none';
    const g = document.getElementById('mainGrid');
    g.innerHTML = '';
    batIndices = [];
    for (let i = 0; i < 9; i++) {
      const isBat = Math.random() > 0.4; 
      if (isBat) batIndices.push(i);
      const tile = document.createElement('div');
      tile.className = 'tile';
      if (isBat) {
        const bat = document.createElement('img');
        bat.src = batGif; bat.className = 'flying-bat';
        bat.style.animationDelay = (Math.random() * 2) + "s";
        bat.onclick = (e) => { e.stopPropagation(); tile.classList.toggle('selected'); };
        tile.appendChild(bat);
      } else {
        const ghost = document.createElement('img');
        ghost.src = ghostGif; ghost.className = 'ghost-decoy';
        ghost.onclick = () => tile.classList.toggle('selected');
        tile.appendChild(ghost);
      }
      g.appendChild(tile);
    }
  }

  function checkAnswer() {
    document.getElementById('loader-overlay').style.display = 'flex';
    setTimeout(() => {
      const tiles = document.querySelectorAll('#mainGrid .tile');
      let isCorrect = true;
      tiles.forEach((tile, index) => {
        if (tile.classList.contains('selected') !== batIndices.includes(index)) isCorrect = false;
      });
      if (isCorrect && batIndices.length > 0) {
        document.getElementById('loader-overlay').style.display = 'none';
        document.getElementById('status-text').innerText = "Sorry, something went wrong. Please try again later.";
        setTimeout(() => {
            document.getElementById('main-buy-btn').innerText = "OUT OF STOCK";
            document.getElementById('main-buy-btn').style.backgroundColor = "#888";
            closeCaptcha();
            // Restore stock after 4 seconds for troll
            setTimeout(() => {
              document.getElementById('main-buy-btn').innerText = "Add to shopping cart";
              document.getElementById('main-buy-btn').style.backgroundColor = "#0058a3";
              document.getElementById('oos-status').innerText = "";
              trueBuyAvailable = true;
            }, 4000);
        }, 3000);
      } else {
        document.getElementById('loader-overlay').style.display = 'none';
        document.getElementById('status-text').innerText = "Please try again.";
        setTimeout(() => {
            document.getElementById('status-text').innerText = "";
        }, 3000);
        buildGrid();
      }
    }, 1500);
  }

  // Account CAPTCHA Functions
  function showAccountCaptcha() {
    if (!accountCaptchaLocked) {
      document.getElementById('account-captcha-wrapper').style.display = 'flex';
      document.getElementById('account-overlay').style.display = 'block';
      document.getElementById('account-anchor-box').style.display = 'block';
      document.getElementById('account-anchor-image').src = staticAnchor;
      document.getElementById('account-captcha-main-box').style.display = 'none';
      // BUGFIX: Reset accountCaptchaLocked to false when showing captcha
      accountCaptchaLocked = false;
    }
  }

  function closeAccountCaptcha() {
    document.getElementById('account-captcha-wrapper').style.display = 'none';
    document.getElementById('account-overlay').style.display = 'none';
    accountCaptchaLocked = false;
  }

  function playAccountGifAndContinue() {
    if(accountCaptchaLocked) return;
    accountCaptchaLocked = true;
    document.getElementById('account-anchor-image').src = animatedGif + "?t=" + new Date().getTime();
    setTimeout(() => {
        document.getElementById('account-anchor-box').style.display = 'none';
        document.getElementById('account-captcha-main-box').style.display = 'block';
        buildAccountGrid();
    }, 3600);
  }

  function buildAccountGrid() {
    document.getElementById('account-loader-overlay').style.display = 'none';
    const g = document.getElementById('accountGrid');
    g.innerHTML = '';
    carrotIndices = [];
    
    // Select images with proper distribution:
    // 2-3 wild carrots, 1-2 lookalikes, rest are other plants
    const numCarrots = Math.floor(Math.random() * 2) + 2; // 2 or 3
    const numLookalikes = Math.floor(Math.random() * 2) + 1; // 1 or 2
    const numOthers = 9 - numCarrots - numLookalikes;
    
    // Shuffle each category
    const shuffledCarrots = [...wildCarrotImages].sort(() => 0.5 - Math.random());
    const shuffledLookalikes = [...lookalikeImages].sort(() => 0.5 - Math.random());
    const shuffledOthers = [...otherPlantImages].sort(() => 0.5 - Math.random());
    
    // Select from each category
    const selectedCarrots = shuffledCarrots.slice(0, numCarrots);
    const selectedLookalikes = shuffledLookalikes.slice(0, numLookalikes);
    const selectedOthers = shuffledOthers.slice(0, numOthers);
    
    // Combine and shuffle all selected images
    const allSelected = [...selectedCarrots, ...selectedLookalikes, ...selectedOthers];
    const selectedImages = allSelected.sort(() => 0.5 - Math.random());
    
    for (let i = 0; i < 9; i++) {
      const imgUrl = selectedImages[i];
      const isCarrot = wildCarrotImages.includes(imgUrl);
      if (isCarrot) carrotIndices.push(i);
      
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.onclick = () => tile.classList.toggle('selected');
      
      const img = document.createElement('img');
      img.src = imgUrl;
      tile.appendChild(img);
      
      g.appendChild(tile);
    }
  }

  function checkAccountAnswer() {
    document.getElementById('account-loader-overlay').style.display = 'flex';
    setTimeout(() => {
      const tiles = document.querySelectorAll('#accountGrid .tile');
      let isCorrect = true;
      tiles.forEach((tile, index) => {
        if (tile.classList.contains('selected') !== carrotIndices.includes(index)) isCorrect = false;
      });
      
      if (isCorrect && carrotIndices.length > 0) {
        // CAPTCHA passed - create account
        username = pendingUsername;
        isLoggedIn = true;
        localStorage.setItem('ikeaUsername', username);
        
        document.getElementById('account-loader-overlay').style.display = 'none';
        closeAccountCaptcha();
        updateAccountDisplay();
        showNotification('Account created successfully!');
        setTimeout(() => {
          hideAccountPage();
        }, 1500);
      } else {
        document.getElementById('account-loader-overlay').style.display = 'none';
        document.getElementById('account-status-text').innerText = "Please try again.";
        setTimeout(() => {
            document.getElementById('account-status-text').innerText = "";
        }, 3000);
        buildAccountGrid();
      }
    }, 1500);
  }

</script>

</body>
</html>
